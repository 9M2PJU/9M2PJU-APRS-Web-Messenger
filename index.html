<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>9M2PJU Web APRS Messenger</title>
    <meta name="description"
        content="A premium, glassmorphism APRS web messenger for sending and receiving messages via APRS-IS.">
    <link rel="stylesheet" href="src/style.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&family=JetBrains+Mono:wght@400;500;700&display=swap"
        rel="stylesheet">
    <link rel="icon" type="image/png" href="assets/favicon.png">
</head>

<body>
    <div id="app">
        <!-- Login Overlay -->
        <div id="login-overlay" class="overlay">
            <div class="glass-card login-card">
                <img src="assets/brand-logo.png" alt="9M2PJU Web APRS Messenger" class="login-logo">
                <p class="subtitle">Enter your credentials to connect</p>
                <div id="login-error" class="error-text hidden"></div>
                <form id="login-form">
                    <div class="input-group">
                        <label for="callsign">Callsign</label>
                        <input type="text" id="callsign" placeholder="e.g. 9M2PJU-1" required>
                    </div>
                    <div class="input-group">
                        <label for="passcode">Passcode</label>
                        <input type="password" id="passcode" placeholder="Your APRS-IS Passcode" required>
                    </div>
                    <button type="submit" class="btn-primary">Connect</button>
                    <p class="help-text">Need a passcode? <a href="https://pass.hamradio.my" target="_blank">Generate
                            one here</a></p>
                </form>
            </div>
        </div>

        <!-- Main Dashboard -->
        <main id="dashboard" class="hidden">
            <header class="glass-nav">
                <div class="logo">
                    <span class="logo-text">9M2PJU Web APRS <span class="accent">Messenger</span></span>
                </div>
                <div class="user-info">
                    <button id="mobile-menu-btn" class="icon-btn mobile-only" title="Contacts">
                        <svg viewBox="0 0 24 24" width="20" height="20">
                            <path fill="currentColor" d="M3,6H21V8H3V6M3,11H21V13H3V11M3,16H21V18H3V16Z" />
                        </svg>
                    </button>
                    <span id="display-callsign">9M2PJU-1</span>
                    <span id="connection-status" class="status-dot"></span>
                    <button id="mobile-radar-btn" class="icon-btn mobile-only" title="Radar">
                        <svg viewBox="0 0 24 24" width="20" height="20">
                            <path fill="currentColor"
                                d="M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2M12,4A8,8 0 0,1 20,12A8,8 0 0,1 12,20A8,8 0 0,1 4,12A8,8 0 0,1 12,4M12,6A6,6 0 0,0 6,12A6,6 0 0,0 12,18A6,6 0 0,0 18,12A6,6 0 0,0 12,6M12,8A4,4 0 0,1 16,12A4,4 0 0,1 12,16A4,4 0 0,1 8,12A4,4 0 0,1 12,8Z" />
                        </svg>
                    </button>
                    <button id="show-terminal-btn" class="icon-btn" title="Show Terminal" style="display: flex;">
                        <svg viewBox="0 0 24 24" width="20" height="20">
                            <path fill="currentColor"
                                d="M20,19V7H4V19H20M20,3A2,2 0 0,1 22,5V19A2,2 0 0,1 20,21H4A2,2 0 0,1 2,19V5C2,3.89 2.9,3 4,3H20M13,17V15H18V17H13M9.58,13L5.57,9H8.4L11.7,12.3C12.09,12.69 12.09,13.33 11.7,13.72L8.42,17H5.59L9.58,13Z" />
                        </svg>
                    </button>
                    <button id="settings-btn" class="btn-icon" title="Settings">
                        <svg viewBox="0 0 24 24" width="20" height="20">
                            <path fill="currentColor"
                                d="M19.14,12.94c0.04-0.3,0.06-0.61,0.06-0.94c0-0.32-0.02-0.64-0.07-0.94l2.03-1.58c0.18-0.14,0.23-0.41,0.12-0.61 l-1.92-3.32c-0.12-0.22-0.37-0.29-0.59-0.22l-2.39,0.96c-0.5-0.38-1.03-0.7-1.62-0.94L14.4,2.81c-0.04-0.24-0.24-0.41-0.48-0.41 h-3.84c-0.24,0-0.43,0.17-0.47,0.41L9.25,5.35C8.66,5.59,8.12,5.92,7.63,6.29L5.24,5.33c-0.22-0.08-0.47,0-0.59,0.22L2.74,8.87 C2.62,9.08,2.66,9.34,2.86,9.49l2.03,1.58C4.84,11.36,4.8,11.69,4.8,12s0.02,0.64,0.07,0.94l-2.03,1.58 c-0.18,0.14-0.23,0.41-0.12,0.61l1.92,3.32c0.12,0.22,0.37,0.29,0.59,0.22l2.39-0.96c0.5,0.38,1.03,0.7,1.62,0.94l0.36,2.54 c0.05,0.24,0.24,0.41,0.48,0.41h3.84c0.24,0,0.44-0.17,0.47-0.41l0.36-2.54c0.59-0.24,1.13-0.56,1.62-0.94l2.39,0.96 c0.22,0.08,0.47,0,0.59-0.22l1.92-3.32c0.12-0.22,0.07-0.47-0.12-0.61L19.14,12.94z M12,15.6c-1.98,0-3.6-1.62-3.6-3.6 s1.62-3.6,3.6-3.6s3.6,1.62,3.6,3.6S13.98,15.6,12,15.6z" />
                        </svg>
                    </button>
                </div>
                <button id="logout-btn" class="btn-secondary">Logout</button>
            </header>

            <div class="content-wrapper">
                <aside class="sidebar glass-card">
                    <div class="sidebar-header">
                        <h2>Contacts</h2>
                        <button id="add-contact-btn" title="Add Contact">+</button>
                    </div>
                    <ul id="contact-list">
                        <!-- Contacts go here -->
                        <li class="contact active" data-callsign="APRS-IS">
                            <div class="avatar">IS</div>
                            <div class="contact-info">
                                <span class="name">APRS-IS</span>
                                <span class="last-msg">Server Info</span>
                            </div>
                        </li>
                    </ul>
                </aside>

                <section class="chat-area glass-card">
                    <div class="chat-header">
                        <div class="header-left">
                            <h2 id="current-chat-name">APRS-IS</h2>
                            <span class="status">Gateway Active</span>
                        </div>
                        <div class="header-right">
                            <button id="delete-chat-btn" class="icon-btn-small" title="Delete Chat">
                                <svg viewBox="0 0 24 24" width="18" height="18">
                                    <path fill="currentColor"
                                        d="M19,4H15.5L14.5,3H9.5L8.5,4H5V6H19M6,19A2,2 0 0,0 8,21H16A2,2 0 0,0 18,19V7H6V19Z" />
                                </svg>
                            </button>
                        </div>
                    </div>
                    <div id="message-container" class="messages">
                        <!-- Messages go here -->
                        <div class="message received">
                            <div class="msg-bubble">Welcome to 9M2PJU Web APRS Messenger. Connect to start messaging!
                            </div>
                            <span class="time">System</span>
                        </div>
                    </div>
                    <form id="message-form" class="chat-input-area">
                        <input type="text" id="message-input" placeholder="Type a message..." autocomplete="off">
                        <button type="submit" id="send-btn" class="btn-icon">
                            <svg viewBox="0 0 24 24" width="24" height="24">
                                <path fill="currentColor" d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"></path>
                            </svg>
                        </button>
                    </form>
                </section>

                <aside class="radar-sidebar glass-card">
                    <div class="sidebar-header">
                        <h2>Radar & Telemetry</h2>
                        <button id="toggle-radar-btn" class="icon-btn" title="Toggle Radar">
                            <svg viewBox="0 0 24 24" width="20" height="20">
                                <path fill="currentColor"
                                    d="M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2M12,4A8,8 0 0,1 20,12A8,8 0 0,1 12,20A8,8 0 0,1 4,12A8,8 0 0,1 12,4M12,6A6,6 0 0,0 6,12A6,6 0 0,0 12,18A6,6 0 0,0 18,12A6,6 0 0,0 12,6M12,8A4,4 0 0,1 16,12A4,4 0 0,1 12,16A4,4 0 0,1 8,12A4,4 0 0,1 12,8Z" />
                            </svg>
                        </button>
                    </div>
                    <div class="radar-content">
                        <div class="radar-display">
                            <div class="radar-scan"></div>
                            <div class="radar-blip"></div>
                            <span class="radar-status">NO_GPS_LOCK</span>
                        </div>

                        <div class="gps-controls">
                            <button id="manual-gps-btn" class="btn-primary">SEND GPS NOW</button>
                            <button id="map-select-btn" class="btn-secondary"
                                style="width: 100%; margin-top: 10px;">Select on Map</button>
                        </div>

                        <div class="station-info">
                            <h3>Telemetry</h3>
                            <ul id="station-log">
                                <li>ðŸ“¤ Sent: <span id="msg-sent-count">0</span></li>
                                <li>ðŸ“¥ Received: <span id="msg-received-count">0</span></li>
                            </ul>
                        </div>
                    </div>
                </aside>
            </div>
        </main>

        <!-- Settings Modal -->
        <div id="settings-modal" class="overlay hidden">
            <div class="glass-card settings-card">
                <div class="modal-header">
                    <h2>Configuration</h2>
                    <button id="close-settings" class="close-btn">&times;</button>
                </div>
                <div class="settings-content">
                    <div class="input-group">
                        <label>APRS-IS Passcode</label>
                        <input type="password" id="settings-passcode" placeholder="Host/App Passcode">
                    </div>

                    <div class="input-group">
                        <label>APRS Symbol</label>
                        <div class="symbol-preview">
                            <span id="current-symbol-display">/&gt;</span>
                            <span id="current-symbol-name">Car</span>
                        </div>
                        <input type="hidden" id="settings-symbol" value="/>">
                    </div>

                    <div class="input-group">
                        <label>Beacon Interval (min)</label>
                        <input type="number" id="settings-beacon-interval" placeholder="20" min="1" value="20">
                    </div>

                    <div class="input-group">
                        <label>Custom Symbol Code (Optional)</label>
                        <input type="text" id="custom-symbol-input" placeholder="e.g. />, /b, \-" maxlength="2">
                        <small style="color: var(--text-secondary); font-size: 0.75rem;">Enter 2-character APRS symbol
                            code or select from grid below</small>
                    </div>

                    <div class="input-group">
                        <label>Beacon Status Comment</label>
                        <input type="text" id="beacon-comment-input" placeholder="9M2PJU Web APRS Messenger beacon"
                            maxlength="43">
                    </div>

                    <div class="symbol-grid-container">
                        <label>Select Symbol</label>
                        <div id="symbol-grid" class="symbol-grid">
                            <!-- Symbols populated by JS -->
                        </div>
                    </div>

                    <div class="modal-actions">
                        <button id="save-settings" class="btn-primary">Save & Apply</button>
                    </div>
                </div>
            </div>

        </div>

    <!-- Map Modal -->
        <div id="map-modal" class="overlay hidden">
            <div class="glass-card map-card">
                <div class="modal-header">
                    <h2>Select Location</h2>
                    <button id="close-map" class="close-btn">&times;</button>
                </div>
                <div id="map" style="height: 400px; width: 100%; border-radius: 10px; margin-bottom: 15px;"></div>
                <div class="modal-actions">
                    <span id="selected-coords"
                        style="margin-right: auto; font-family: monospace; font-size: 0.8rem; color: var(--accent-color);">No
                        location selected</span>
                    <button id="confirm-location-btn" class="btn-primary" disabled>Send Beacon</button>
                </div>
            </div>
        </div>

        <!-- Mobile Bottom Navigation -->
         <nav class="mobile-nav mobile-only">
            <button class="nav-item active" data-tab="chat">
                <svg viewBox="0 0 24 24" width="24" height="24">
                    <path fill="currentColor" d="M20,2H4A2,2 0 0,0 2,4V22L6,18H20A2,2 0 0,0 22,16V4A2,2 0 0,0 20,2M20,16H6L4,18V4H20V16Z" />
                </svg>
                <span>Chat</span>
            </button>
            <button class="nav-item" data-tab="contacts">
                <svg viewBox="0 0 24 24" width="24" height="24">
                    <path fill="currentColor" d="M12,4A4,4 0 0,1 16,8A4,4 0 0,1 12,12A4,4 0 0,1 8,8A4,4 0 0,1 12,4M12,14C16.42,14 20,15.79 20,18V20H4V18C4,15.79 7.58,14 12,14Z" />
                </svg>
                <span>Contacts</span>
            </button>
            <button class="nav-item" data-tab="radar">
                <svg viewBox="0 0 24 24" width="24" height="24">
                    <path fill="currentColor" d="M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2M12,4A8,8 0 0,1 20,12A8,8 0 0,1 12,20A8,8 0 0,1 4,12A8,8 0 0,1 12,4M12,6A6,6 0 0,0 6,12A6,6 0 0,0 12,18A6,6 0 0,0 18,12A6,6 0 0,0 12,6M12,8A4,4 0 0,1 16,12A4,4 0 0,1 12,16A4,4 0 0,1 8,12A4,4 0 0,1 12,8Z" />
                </svg>
                <span>Radar</span>
            </button>
            <button class="nav-item" id="mobile-settings-btn">
                <svg viewBox="0 0 24 24" width="24" height="24">
                    <path fill="currentColor" d="M19.14,12.94c0.04-0.3,0.06-0.61,0.06-0.94c0-0.32-0.02-0.64-0.07-0.94l2.03-1.58c0.18-0.14,0.23-0.41,0.12-0.61 l-1.92-3.32c-0.12-0.22-0.37-0.29-0.59-0.22l-2.39,0.96c-0.5-0.38-1.03-0.7-1.62-0.94L14.4,2.81c-0.04-0.24-0.24-0.41-0.48-0.41 h-3.84c-0.24,0-0.43,0.17-0.47,0.41L9.25,5.35C8.66,5.59,8.12,5.92,7.63,6.29L5.24,5.33c-0.22-0.08-0.47,0-0.59,0.22L2.74,8.87 C2.62,9.08,2.66,9.34,2.86,9.49l2.03,1.58C4.84,11.36,4.8,11.69,4.8,12s0.02,0.64,0.07,0.94l-2.03,1.58 c-0.18,0.14-0.23,0.41-0.12,0.61l1.92,3.32c0.12,0.22,0.37,0.29,0.59,0.22l2.39-0.96c0.5,0.38,1.03,0.7,1.62,0.94l0.36,2.54 c0.05,0.24,0.24,0.41,0.48,0.41h3.84c0.24,0,0.44-0.17,0.47-0.41l0.36-2.54c0.59-0.24,1.13-0.56,1.62-0.94l2.39,0.96 c0.22,0.08,0.47,0,0.59-0.22l1.92-3.32c0.12-0.22,0.07-0.47-0.12-0.61L19.14,12.94z" />
                </svg>
                <span>Settings</span>
            </button>
         </nav>
    </div>



    <!-- Raw Terminal -->
    <footer id="terminal-footer" class="hidden">
        <div class="terminal-header" id="toggle-terminal">
            <span>RAW_PACKET_STREAM</span>
            <span class="terminal-toggle-icon">â–²</span>
        </div>
        <div id="terminal-content" class="terminal-content hidden">
            <div id="terminal-output">
                <!-- Logs go here -->
                <div class="log-line system">System Ready.</div>
            </div>
        </div>
    </footer>
    </div>

    <!-- Toast Notification Container -->
    <div id="toast-container" class="toast-container"></div>

    <script src="src/aprs.js" type="module"></script>
    <script src="src/app.js" type="module"></script>
    <!-- Leaflet JS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
        integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin="" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
        integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
</body>

</html>